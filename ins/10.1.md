Please read the attached AI_CONTEXT.md file. We need to implement the Many-to-Many relationship between Products and Suppliers, but with a specific requirement: One supplier can have MULTIPLE product links for the same product.

Task 1: Create Migration for Pivot Table Modification

Since we already created the product_supplier table in Step 1, we need to modify it.

Create a new migration: update_product_supplier_table_for_json_links.

Change: Drop the column supplier_product_url (string) and add supplier_product_urls (json).

Default: It should default to [] (empty array) or null.

Task 2: Update Models

Update app/Models/Product.php:

Update the suppliers() relationship.

It must retrieve the new pivot column: withPivot('supplier_product_urls').

Crucial: Add a custom accessor or cast logic to ensure supplier_product_urls comes out as an Array, not a string. (Laravel AsArrayObject or $casts in the intermediate model if you use one, otherwise handle it in the Controller).

Update app/Models/Supplier.php:

Add the inverse products() relationship with withPivot('supplier_product_urls').

Task 3: Create ProductSupplierController

Generate app/Http/Controllers/Api/V1/Admin/ProductSupplierController.php.

store(Request $request, Product $product):

Goal: Attach OR Update a supplier for a product.

Validation:

supplier_id: required, exists:suppliers,id.

supplier_product_urls: required, array. (e.g., ["http://link1.com", "http://link2.com"]).

supplier_product_urls.*: required, url.

Logic:

Use $product->suppliers()->syncWithoutDetaching([...]).

Save the URLs as a JSON encoded array.

Response: Return the updated list of suppliers for that product.

destroy(Product $product, Supplier $supplier):

Goal: Detach a supplier.

Logic: $product->suppliers()->detach($supplier->id);

Task 4: Update Routes

Add these routes to routes/api.php (Admin Group):

PHP

Route::post('/products/{product}/suppliers', [App\Http\Controllers\Api\V1\Admin\ProductSupplierController::class, 'store']);
Route::delete('/products/{product}/suppliers/{supplier}', [App\Http\Controllers\Api\V1\Admin\ProductSupplierController::class, 'destroy']);
Provide the code for:

The Migration file.

ProductSupplierController.php.

Updated Model logic.